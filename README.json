{
  "name": "WorkMesh",
  "tagline": "Docs-first, MCP-ready tasks and project continuity stored as plain text alongside your code.",
  "start_here": "docs/getting-started.md",
  "agent_readme": {
    "file": "README.json",
    "mcp_tool": "readme"
  },
  "repo": {
    "language": "rust",
    "artifacts": ["workmesh (cli)", "workmesh-mcp (stdio mcp server)"]
  },
  "diagrams": {
    "dx_workflow": "docs/diagrams/dx-workflow.png",
    "install_and_mcp": "docs/diagrams/install-and-mcp.png",
    "task_lifecycle": "docs/diagrams/task-lifecycle.png",
    "session_continuity": "docs/diagrams/continuity.png"
  },
  "why": [
    "Keep planning artifacts close to code and in git.",
    "Make dependencies explicit so ready work is queryable.",
    "Enable restartable work via checkpoints and cross-repo sessions.",
    "Support multi-agent coordination with leases/claims and deterministic ordering."
  ],
  "install": {
    "prebuilt_releases": {
      "note": "Each GitHub release includes platform archives. Pick the right Rust target triple for your OS/CPU.",
      "targets": [
        "x86_64-apple-darwin (macOS Intel)",
        "aarch64-apple-darwin (macOS Apple Silicon)",
        "x86_64-unknown-linux-gnu (Linux x86_64, glibc)",
        "aarch64-unknown-linux-gnu (Linux arm64, glibc)",
        "x86_64-pc-windows-msvc (Windows x86_64)"
      ],
      "macos_linux_steps": [
        "Download the release archive (with gh or browser).",
        "Extract it.",
        "Install workmesh and workmesh-mcp onto PATH (e.g. /usr/local/bin).",
        "Optional: install the embedded skill into detected agent folders: workmesh --root . skill install-global --force.",
        "Verify: workmesh --version; workmesh-mcp --version."
      ],
      "windows_steps": [
        "Download the zip.",
        "Extract it.",
        "Add the extracted folder to PATH (or move binaries into a PATH directory).",
        "Verify: workmesh.exe --version; workmesh-mcp.exe --version."
      ]
    },
    "from_source": {
      "requirements": ["rust (stable toolchain)"],
      "steps": [
        "git clone git@github.com:luislobo/workmesh.git",
        "cd workmesh",
        "cargo build",
        "cargo build -p workmesh-mcp (optional)"
      ],
      "binaries": {
        "cli_debug": "target/debug/workmesh",
        "mcp_debug": "target/debug/workmesh-mcp"
      }
    }
  },
  "quickstart": {
    "commands": [
      "workmesh --root . quickstart <project-id> --agents-snippet",
      "workmesh --root . focus set --project-id <project-id> --epic-id task-<init>-001 --objective \"Ship v0.3\" (recommended)",
      "workmesh --root . list --status \"To Do\"",
      "workmesh --root . next",
      "workmesh --root . set-status task-<init>-001 \"In Progress\"",
      "workmesh --root . note task-<init>-001 \"Found missing edge case\"",
      "workmesh --root . set-status task-<init>-001 Done"
    ],
    "creates": {
      "docs": ["docs/projects/<project-id>/README.md", "docs/projects/<project-id>/prds/", "docs/projects/<project-id>/updates/"],
      "workmesh": ["workmesh/tasks/task-<init>-001 - seed task.md"]
    }
  },
  "concepts": {
    "task_files": {
      "format": "markdown with yaml front matter",
      "fields": ["id", "uid", "title", "kind", "status", "priority", "phase", "dependencies", "labels", "assignee"],
      "note": "Dependencies are optional, but recommended when a task is blocked."
    },
    "task_ids": {
      "default_format": "task-<initiative>-NNN",
      "examples": ["task-logi-001", "task-bill-014"],
      "initiative_source": "Derived from git branch name (last path segment), converted into a 4-letter key, then frozen in .workmesh.toml",
      "config_fields": ["branch_initiatives", "initiatives"],
      "collision_behavior": "If the desired 4-letter initiative key is already used, WorkMesh deterministically chooses another 4-letter key (still length 4).",
      "override_env": "WORKMESH_BRANCH",
      "rekey_flow": {
        "purpose": "Agent-assisted migration from legacy ids (task-001) to initiative-key ids (task-logi-001) while rewriting structured references and (by default) body mentions.",
        "cli": [
          "workmesh --root . rekey-prompt > rekey-prompt.txt",
          "workmesh --root . rekey-apply --mapping mapping.json (dry-run; default rewrites structured fields + body mentions)",
          "workmesh --root . rekey-apply --mapping mapping.json --apply",
          "workmesh --root . rekey-apply --mapping mapping.json --strict --apply (structured-only; no body edits)"
        ],
        "mcp_tools": ["rekey_prompt", "rekey_apply"]
      },
      "repair": {
        "purpose": "After merges, detect and rekey duplicate task ids.",
        "cli": ["workmesh --root . fix-ids (dry-run)", "workmesh --root . fix-ids --apply"],
        "mcp_tool": "fix_ids"
      }
    },
    "kind": {
      "note": "Jira-friendly. WorkMesh does not enforce a taxonomy; use any string.",
      "recommended": ["epic", "story", "task", "bug", "subtask", "incident", "spike"],
      "epic_done_rule": "When kind=epic, WorkMesh refuses to set status Done unless dependencies, blocked_by, and all children (inferred via relationships.parent and explicit relationships.child) are Done."
    },
    "focus": {
      "path": "workmesh/focus.json",
      "purpose": "Repo-local pointer for project/epic/objective to keep agents scoped and reduce thrash.",
      "commands": [
        "workmesh --root . focus show [--json]",
        "workmesh --root . focus set --project-id <pid> [--epic-id task-123] [--objective \"...\"]",
        "workmesh --root . focus clear"
      ],
      "auto_updates": [
        "When focus exists, mutating commands keep focus.working_set in sync: set-status(In Progress) adds; set-status(To Do/Done) removes; claim adds.",
        "When focus.epic_id is set and that epic becomes fully complete, WorkMesh auto-cleans focus by clearing epic_id and working_set (project_id is preserved).",
        "Focus changes (manual and auto) are recorded in .audit.log (ignored by default; optionally commit for a full repo-local PM history)."
      ],
      "integration": [
        "session save captures epic_id from focus (fallback: parse task-123 from git branch).",
        "session resume resume-script includes focus show.",
        "next/next_task/next_tasks are focus-aware: focus.working_set tasks are recommended first; active work (In Progress / leased) in the working set is prioritized before unrelated ready To Do tasks."
      ]
    },
    "views_and_diagnostics": {
      "doctor": {
        "cli": "workmesh --root . doctor --json",
        "mcp_tool": "doctor",
        "purpose": "One-shot diagnostics for layout, focus, index, skills, and versions."
      },
      "board": {
        "cli": ["workmesh --root . board", "workmesh --root . board --by phase", "workmesh --root . board --focus"],
        "mcp_tool": "board",
        "purpose": "Swimlanes grouped by status/phase/priority; stable ordering."
      },
      "blockers": {
        "cli": ["workmesh --root . blockers", "workmesh --root . blockers --epic-id task-123"],
        "mcp_tool": "blockers",
        "purpose": "Show blocked work and top blockers (focus epic by default)."
      }
    },
    "index": {
      "path": "workmesh/.index/tasks.jsonl",
      "format": "jsonl",
      "purpose": "Fast queries; rebuild/refresh/verify.",
      "path_values": "repo-relative (does not embed /home/user/...)",
      "commands": ["index-rebuild", "index-refresh", "index-verify"]
    },
    "archive": {
      "path": "workmesh/archive/YYYY-MM/",
      "purpose": "Keep Done tasks out of the hot path; date-based archiving."
    },
    "sessions": {
      "repo_local": {
        "tools": ["checkpoint", "resume", "checkpoint-diff"],
        "purpose": "Continue work within the same repo."
      },
      "global": {
        "home_env": "WORKMESH_HOME (default: ~/.workmesh)",
        "files": {
          "events": "WORKMESH_HOME/sessions/events.jsonl (append-only)",
          "current": "WORKMESH_HOME/sessions/current.json",
          "index": "WORKMESH_HOME/.index/sessions.jsonl (derived)"
        },
        "tools": ["session save", "session list", "session show", "session resume"],
        "purpose": "Cross-repo continuity (reboot/OS switch/machine switch)."
      }
    },
    "leases": {
      "tools": ["claim", "release"],
      "purpose": "Multi-agent coordination; avoid stepping on the same task."
    }
  },
  "mcp": {
    "server_binary": "workmesh-mcp",
    "transport": "stdio",
    "root_behavior": "If started inside a repo, root can be omitted; otherwise pass root explicitly in calls.",
    "examples": [
      { "tool": "doctor", "format": "json" },
      { "tool": "board", "format": "json", "by": "status", "focus": true },
      { "tool": "blockers", "format": "json" },
      { "tool": "ready_tasks", "format": "json" },
      { "tool": "next_tasks", "format": "json", "limit": 10 },
      { "tool": "list_tasks", "root": "/path/to/repo", "status": ["To Do"] }
    ],
    "note": "All CLI commands are mirrored as MCP tools (parity tests cover the mapping)."
  },
  "repo_layout": {
    "docs": "docs/ (PRDs, decisions, updates)",
    "tasks": "workmesh/tasks/ (task markdown files)",
    "archive": "workmesh/archive/ (archived tasks)",
    "skills": "skills/ (agent workflow instructions)",
    "crates": "crates/ (workmesh-core, workmesh-cli, workmesh-mcp)"
  },
  "derived_files_policy": {
    "do_not_commit": ["workmesh/.index/", "WORKMESH_HOME/.index/"],
    "optional_to_commit": ["workmesh/.audit.log"],
    "safe_to_delete": true
  },
  "roadmap": {
    "near_term": [
      "Harden session continuity (more metadata, richer resume output).",
      "Expand validation and reporting."
    ],
    "later": ["External sync (Jira/Trello/GitHub) deferred.", "UI/visualization layer."]
  }
}
